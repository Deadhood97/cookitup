(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();const t={FLOUR:"Flour",WATER:"Water",FIRE:"Fire",DOUGH:"Dough",BREAD:"Bread",TOMATO:"Tomato",CHEESE:"Cheese",BASE:"Base",RAW_PIZZA:"Raw Pizza",PIZZA:"Pizza",CRUST:"Crust",SAUCED_CRUST:"Sauced Crust",SOGGY_DOUGH:"Soggy Dough",BURNT_GOOP:"Burnt_Goop",MEAT:"Meat",SANDWICH:"Sandwich",SUGAR:"Sugar",BATTER:"Sweet_Batter",CAKE:"Cake",CALZONE:"Calzone",RICE:"Rice",NORI:"Nori",FISH:"Fish",KNIFE:"Knife",SUSHI:"Sushi",SASHIMI:"Sashimi",CHILI:"Chili",TURMERIC:"Turmeric",PANEER:"Paneer",CHICKEN:"Chicken",GRINDER:"Grinder",CHILI_POWDER:"Chili_Powder",TURMERIC_POWDER:"Turmeric_Powder",CURRY_BASE:"Curry_Base",BUTTER_CHICKEN:"Butter_Chicken",PANEER_TIKKA:"Paneer_Tikka"},a={RAW:"raw",COOKED:"cooked",BURNT:"burnt",SOGGY:"soggy"},I={MERGE_BASE:10,REACTION_BASE:50,WIN_BONUS:1e3};class Q{state;gridSize=4;config;tileIdCounter=0;difficulty;listeners={};history=[];MAX_HISTORY=5;constructor(e,i="medium"){this.config=e,this.difficulty=i,this.state=this.getInitialState(),this.state.nextTile=this.pickNextTile()}on(e,i){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(i)}emit(e,i){this.listeners[e]&&this.listeners[e].forEach(s=>s(i))}getInitialState(){return{grid:Array(this.gridSize).fill(null).map(()=>Array(this.gridSize).fill(null)),score:0,moves:0,activeOrders:[],status:"playing",nextTile:""}}getState(){return this.state}getConfig(){return this.config}canUndo(){return this.history.length>0&&this.state.status==="playing"}undo(){if(!this.canUndo())return;const e=this.history.pop();e&&(this.state=JSON.parse(e))}pushHistory(e){this.history.length>=this.MAX_HISTORY&&this.history.shift(),this.history.push(e)}initialize(){this.state=this.getInitialState(),this.state.nextTile=this.pickNextTile(),this.history=[],this.config.layout&&this.config.layout.forEach(e=>{const i=this.createTile(e.item,"raw");e.isStatic&&(i.isStatic=!0),this.state.grid[e.position[0]][e.position[1]]=i}),this.spawnTile(),this.spawnTile()}restart(){this.initialize()}move(e){if(this.state.status!=="playing")return;const i=JSON.stringify(this.state);let s=!1;const n=this.getVector(e),r=this.buildTraversals(n);r.x.forEach(u=>{r.y.forEach(l=>{const d={row:u,col:l},R=this.state.grid[u][l];if(R&&!R.isStatic){const c=this.findFarthestPosition(d,n),E=this.getCellContent(c.next);if(E&&this.canReact(R,E)){const p=this.getReaction(R,E);p&&(p.output===null?(E.isStatic||(this.state.grid[c.next.row][c.next.col]=null),this.state.grid[u][l]=null):(E.isStatic?(this.state.grid[u][l]=this.createTile(p.output,p.outputState),this.emit("reaction",{type:p.outputState,text:p.outputState})):(this.state.grid[c.next.row][c.next.col]=this.createTile(p.output,p.outputState),this.state.grid[u][l]=null,this.emit("reaction",{type:p.outputState,text:p.outputState})),this.state.score+=I.REACTION_BASE),s=!0)}else if(E&&this.canMerge(R,E)){const p=E.level+1;p<=4?(E.level=p,this.state.grid[u][l]=null,this.state.score+=I.MERGE_BASE*p,s=!0,this.emit("merge",{level:p})):(this.moveTile(d,c.farthest),(d.row!==c.farthest.row||d.col!==c.farthest.col)&&(s=!0))}else this.moveTile(d,c.farthest),(d.row!==c.farthest.row||d.col!==c.farthest.col)&&(s=!0)}})}),s&&(this.pushHistory(i),this.spawnTile(),this.state.moves++,this.checkWinCondition(),this.state.status!=="won"&&this.checkLossCondition())}checkWinCondition(){this.config.winCondition(this.state)&&(this.state.status="won",this.state.score+=I.WIN_BONUS,this.emit("win",{}))}checkLossCondition(){for(let e=0;e<this.gridSize;e++)for(let i=0;i<this.gridSize;i++)if(!this.state.grid[e][i])return;for(let e=0;e<this.gridSize;e++)for(let i=0;i<this.gridSize;i++){const s=this.state.grid[e][i];if(i<this.gridSize-1){const n=this.state.grid[e][i+1];if(this.canMerge(s,n)||this.canReact(s,n)||this.canReact(n,s))return}if(e<this.gridSize-1){const n=this.state.grid[e+1][i];if(this.canMerge(s,n)||this.canReact(s,n)||this.canReact(n,s))return}}this.state.status="lost",this.emit("loss",{})}getVector(e){return{up:{x:-1,y:0},down:{x:1,y:0},left:{x:0,y:-1},right:{x:0,y:1}}[e]}buildTraversals(e){const i=[],s=[];for(let n=0;n<this.gridSize;n++)i.push(n);for(let n=0;n<this.gridSize;n++)s.push(n);return e.x===1&&i.reverse(),e.y===1&&s.reverse(),{x:i,y:s}}findFarthestPosition(e,i){let s,n=e;do s=n,n={row:s.row+i.x,col:s.col+i.y};while(this.withinBounds(n)&&this.cellAvailable(n));return{farthest:s,next:n}}withinBounds(e){return e.row>=0&&e.row<this.gridSize&&e.col>=0&&e.col<this.gridSize}cellAvailable(e){return!this.state.grid[e.row][e.col]}getCellContent(e){return this.withinBounds(e)?this.state.grid[e.row][e.col]:null}canReact(e,i){return!!this.getReaction(e,i)}getReaction(e,i){return this.config.reactions.find(s=>s.inputA===e.name&&s.inputB===i.name&&!0)}canMerge(e,i){return e.name===i.name&&e.state===i.state&&e.level===i.level&&e.level<4}moveTile(e,i){e.row===i.row&&e.col===i.col||(this.state.grid[i.row][i.col]=this.state.grid[e.row][e.col],this.state.grid[e.row][e.col]=null)}createTile(e,i){const s=this.config.tileProps[e]||{type:"ingredient"};return{id:`tile-${this.tileIdCounter++}`,type:s.type,name:e,state:i,level:1,isStatic:s.isStatic}}pickNextTile(){const e=Math.random();let i=0,s=this.config.spawns;this.config.difficultySpawns&&this.config.difficultySpawns[this.difficulty]&&(s=this.config.difficultySpawns[this.difficulty]);let n=Object.keys(s)[0];for(const[r,u]of Object.entries(s))if(i+=u,e<=i){n=r;break}return n}spawnTile(){const e=[];for(let i=0;i<this.gridSize;i++)for(let s=0;s<this.gridSize;s++)this.state.grid[i][s]||e.push({row:i,col:s});if(e.length>0){const{row:i,col:s}=e[Math.floor(Math.random()*e.length)],n=this.state.nextTile;this.state.grid[i][s]=this.createTile(n,"raw"),this.state.nextTile=this.pickNextTile()}}}const W="elemental_chef_progress_v1",f={validateProgression(o,e){Object.keys(e).forEach(i=>{const s=e[i],n=o.levels[i];n&&n.stars>0&&s.nextLevelId&&(o.levels[s.nextLevelId]||(console.log(`Auto-unlocking fixed level: ${s.nextLevelId}`),this.unlockLevel(o,s.nextLevelId)))})},load(o){const e=localStorage.getItem(W);let i;return e?i=JSON.parse(e):i=this.getInitialProgress(),o&&this.validateProgression(i,o),i},save(o){localStorage.setItem(W,JSON.stringify(o))},getInitialProgress(){return{levels:{bakery_1:{stars:0,unlocked:!0}},lastPlayedLevel:"bakery_1"}},unlockLevel(o,e){o.levels[e]||(o.levels[e]={stars:0,unlocked:!0},this.save(o))},completeLevel(o,e,i,s){o.levels[e]||(o.levels[e]={stars:0,unlocked:!0}),o.levels[e].stars=Math.max(o.levels[e].stars,i),s&&this.unlockLevel(o,s),this.save(o)}},T="/cookitup/assets/flour-CYguaQ-D.png",V="/cookitup/assets/water-FF_abEj4.png",tt="/cookitup/assets/fire-DptnGgzr.png",et="/cookitup/assets/dough-Bow15AsV.png",it="/cookitup/assets/bread-BIwyZljX.png",F="/cookitup/assets/tomato-ByOp1vzN.png",P="/cookitup/assets/cheese-CqOtmIlT.png",st="/cookitup/assets/pizza_base-BSJ2-Wi1.png",nt="/cookitup/assets/raw_pizza-D3IMk3Dx.png",x="/cookitup/assets/baked_pizza-BDhrz11X.png",z="/cookitup/assets/crust-CiqSkRXh.png",K="/cookitup/assets/sauced_crust-C5ylwZfH.png",$="/cookitup/assets/soggy_dough-DvHcZxxl.png",ot="/cookitup/assets/burnt_goop-BL0aTWhi.png",Z="/cookitup/assets/clean-LaCagiq1.png",Y="/cookitup/assets/meat-Pbe1Pbag.png",j="/cookitup/assets/sandwich-R--evtQv.png",at="/cookitup/assets/sugar-ae2k0XQk.png",rt="/cookitup/assets/batter-C-O-qA6g.png",ut="/cookitup/assets/cake-DU68_eQC.png",lt="/cookitup/assets/knife-DzZT849N.png",ct="/cookitup/assets/sashimi-DHJnahL3.png",dt="/cookitup/assets/calzone-DPukRUgc.png",pt="/cookitup/assets/sushi-hvOFpE_G.png",ht="/cookitup/assets/fish-oDbnYQrD.png",Et="/cookitup/assets/rice_ball-BAJk1CtN.png",Rt="/cookitup/assets/nori-CWMtddD7.png",mt="/cookitup/assets/sushi_base-ChJcEJxI.png",gt={[t.FLOUR]:T,[t.WATER]:V,[t.FIRE]:tt,[t.DOUGH]:et,[t.BREAD]:it,[t.TOMATO]:F,[t.CHEESE]:P,[t.BASE]:st,[t.RAW_PIZZA]:nt,[t.PIZZA]:x,[t.CRUST]:z,[t.SAUCED_CRUST]:K,[t.SOGGY_DOUGH]:$,[t.BURNT_GOOP]:ot,Clean:Z,[t.MEAT]:Y,[t.SANDWICH]:j,[t.SUGAR]:at,[t.BATTER]:rt,[t.CAKE]:ut,[t.CALZONE]:dt,[t.RICE]:T,[t.NORI]:Rt,[t.FISH]:ht,[t.SASHIMI]:ct,[t.KNIFE]:lt,[t.SUSHI]:pt,Cooked_Rice:Et,Sushi_Base:mt,[t.CHILI]:F,[t.TURMERIC]:P,[t.PANEER]:Z,[t.CHICKEN]:Y,[t.GRINDER]:z,[t.CHILI_POWDER]:$,[t.TURMERIC_POWDER]:T,[t.CURRY_BASE]:K,[t.BUTTER_CHICKEN]:x,[t.PANEER_TIKKA]:j};class A{static getAsset(e){return gt[e]||""}}class At{tileContainer;scoreEl;overlay;overlayMsg;buttonNext;recipeList;tileElements=new Map;engine=null;timerInterval=null;constructor(){this.tileContainer=document.getElementById("tile-container"),this.scoreEl=document.getElementById("score"),this.overlay=document.getElementById("overlay"),this.overlayMsg=document.getElementById("overlay-msg"),this.buttonNext=document.getElementById("next-level-btn"),this.recipeList=document.getElementById("recipe-list")}setEngine(e){this.engine=e}clearTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}startTimer(e,i){this.clearTimer();let s=e;const n=document.getElementById("timer");n&&(n.textContent=this.formatTime(s),n.classList.remove("warning"),this.timerInterval=window.setInterval(()=>{s--,n.textContent=this.formatTime(s),s<=10&&n.classList.add("warning"),s<=0&&(this.clearTimer(),i())},1e3))}formatTime(e){const i=Math.floor(e/60),s=e%60;return`${i}:${s.toString().padStart(2,"0")}`}render(e,i){document.body.contains(this.tileContainer)||this.rebindElements();const s=new Set;e.grid.forEach((u,l)=>{u.forEach((d,R)=>{if(d){s.add(d.id);let c=this.tileElements.get(d.id);c||(c=this.createTileElement(d),this.tileElements.set(d.id,c),this.tileContainer.appendChild(c)),this.updateTilePosition(c,d,l,R)}})}),this.tileElements.forEach((u,l)=>{s.has(l)||(u.remove(),this.tileElements.delete(l))}),this.scoreEl&&(this.scoreEl.textContent=`Score: ${e.score} | Moves: ${e.moves}`);const n=document.getElementById("undo-btn");n&&(i.canUndo()?(n.removeAttribute("disabled"),n.classList.remove("disabled")):(n.setAttribute("disabled","true"),n.classList.add("disabled")));const r=document.getElementById("next-tile-icon");r&&e.nextTile&&(r.src=A.getAsset(e.nextTile)),this.handleOverlay(e)}rebindElements(){this.tileContainer=document.getElementById("tile-container"),this.scoreEl=document.getElementById("score"),this.overlay=document.getElementById("overlay"),this.overlayMsg=document.getElementById("overlay-msg"),this.buttonNext=document.getElementById("next-level-btn"),this.recipeList=document.getElementById("recipe-list"),this.tileElements.clear()}handleOverlay(e){if(e.status!=="playing")if(this.clearTimer(),this.overlay&&this.overlay.classList.remove("hidden"),e.status==="won"){const i=this.engine?.getConfig();if(i){const s=this.calculateStars(e.moves,i.starThresholds);this.overlayMsg.textContent=`Level Complete! ${s} Stars!`;const n=f.load();f.completeLevel(n,i.id,s,i.nextLevelId)}this.buttonNext&&this.buttonNext.classList.remove("hidden")}else this.overlayMsg.textContent=e.status==="lost"?"Game Over":"Time's Up!",this.buttonNext&&this.buttonNext.classList.add("hidden");else this.overlay&&this.overlay.classList.add("hidden")}calculateStars(e,i){return e<=i[3]?3:e<=i[2]?2:1}createTileElement(e){const i=document.createElement("div");return i.dataset.id=e.id,i}updateTilePosition(e,i,s,n){if(e.className=`tile ${i.type} ${i.state}`,i.level>1&&e.classList.add(`level-${i.level}`),e.dataset.name!==i.name){e.innerHTML="";const E=document.createElement("img");E.src=A.getAsset(i.name),E.draggable=!1,e.appendChild(E),i.type==="ingredient"&&i.level>1&&this.addLevelBadge(e,i.level)}i.type==="ingredient"&&i.level>1&&!e.querySelector(".level-badge")&&this.addLevelBadge(e,i.level),e.dataset.name=i.name;const u=this.tileContainer.clientWidth||370,l=10,d=(u-5*l)/4,R=l+s*(d+l),c=l+n*(d+l);e.style.width=`${d}px`,e.style.height=`${d}px`,e.style.transform=`translate(${c}px, ${R}px)`}addLevelBadge(e,i){const s=document.createElement("div");s.className="level-badge",s.textContent=`x${i}`,e.appendChild(s)}renderRecipes(e){if(!this.recipeList)return;const i=e.reactions,s=[],n=new Set;for(const r of i){const u=[r.inputA,r.inputB].sort().join("+");n.has(u)||(n.add(u),s.push(r))}this.recipeList.innerHTML=s.map(r=>{const u=r.output===null?"Clean":r.output,l=A.getAsset(u);return`
            <div class="recipe-item">
                <div class="combine">
                    <img src="${A.getAsset(r.inputA)}" class="icon-small" title="${r.inputA}">
                    <span>+</span>
                    <img src="${A.getAsset(r.inputB)}" class="icon-small" title="${r.inputB}">
                </div>
                <span>=</span>
                <img src="${l}" class="icon-medium" title="${u}">
                <span class="recipe-name">${u}</span>
            </div>
        `}).join("")+`
            <div class="tip-box">
                <p><strong>Goal:</strong> ${e.description}</p>
            </div>
        `}showFloatingText(e,i){const s=document.createElement("div");s.className=`floating-text ${i}`,s.textContent=e,s.style.left="50%",s.style.top="40%",document.body.appendChild(s),setTimeout(()=>s.remove(),1e3)}}const q=[{inputA:t.WATER,inputB:t.FLOUR,output:t.DOUGH,outputState:a.RAW},{inputA:t.FLOUR,inputB:t.WATER,output:t.DOUGH,outputState:a.RAW},{inputA:t.FIRE,inputB:t.DOUGH,output:t.BREAD,outputState:a.COOKED},{inputA:t.DOUGH,inputB:t.FIRE,output:t.BREAD,outputState:a.COOKED}],C={id:"bakery_1",worldId:1,nextLevelId:"bakery_2",starThresholds:{1:50,2:30,3:15},name:"1. Morning Toast",description:"Make a warm Loaf of Bread.",theme:"bakery",reactions:q,tileProps:{[t.FLOUR]:{type:"ingredient"},[t.WATER]:{type:"element"},[t.FIRE]:{type:"element"},[t.DOUGH]:{type:"ingredient"},[t.BREAD]:{type:"result"}},spawns:{[t.FLOUR]:.6,[t.WATER]:.3,[t.FIRE]:.1},winCondition:o=>o.grid.flat().some(e=>e?.name===t.BREAD&&e.state===a.COOKED)},O={id:"bakery_2",worldId:1,nextLevelId:"bakery_3",starThresholds:{1:80,2:50,3:30},name:"2. The Sandwich",description:"Combine Bread and Meat!",theme:"bakery",reactions:[...q,{inputA:t.BREAD,inputB:t.MEAT,output:t.SANDWICH,outputState:a.RAW},{inputA:t.MEAT,inputB:t.BREAD,output:t.SANDWICH,outputState:a.RAW}],tileProps:{[t.FLOUR]:{type:"ingredient"},[t.WATER]:{type:"element"},[t.FIRE]:{type:"element"},[t.DOUGH]:{type:"ingredient"},[t.BREAD]:{type:"ingredient"},[t.MEAT]:{type:"ingredient"},[t.SANDWICH]:{type:"result"}},spawns:{[t.FLOUR]:.5,[t.WATER]:.25,[t.FIRE]:.1,[t.MEAT]:.15},winCondition:o=>o.grid.flat().some(e=>e?.name===t.SANDWICH)},y={id:"bakery_3",worldId:1,nextLevelId:"pizzeria_1",starThresholds:{1:120,2:90,3:60},name:"3. Celebration Cake",description:"Dough + Sugar -> Batter. Bake it!",theme:"bakery",reactions:[{inputA:t.WATER,inputB:t.FLOUR,output:t.DOUGH,outputState:a.RAW},{inputA:t.FLOUR,inputB:t.WATER,output:t.DOUGH,outputState:a.RAW},{inputA:t.DOUGH,inputB:t.SUGAR,output:t.BATTER,outputState:a.RAW},{inputA:t.SUGAR,inputB:t.DOUGH,output:t.BATTER,outputState:a.RAW},{inputA:t.BATTER,inputB:t.FIRE,output:t.CAKE,outputState:a.COOKED},{inputA:t.FIRE,inputB:t.BATTER,output:t.CAKE,outputState:a.COOKED},{inputA:t.DOUGH,inputB:t.FIRE,output:t.BREAD,outputState:a.COOKED},{inputA:t.FIRE,inputB:t.DOUGH,output:t.BREAD,outputState:a.COOKED}],tileProps:{[t.FLOUR]:{type:"ingredient"},[t.WATER]:{type:"element"},[t.FIRE]:{type:"element"},[t.DOUGH]:{type:"ingredient"},[t.BREAD]:{type:"result"},[t.SUGAR]:{type:"ingredient"},[t.BATTER]:{type:"ingredient"},[t.CAKE]:{type:"result"}},spawns:{[t.FLOUR]:.4,[t.WATER]:.2,[t.FIRE]:.1,[t.SUGAR]:.3},winCondition:o=>o.grid.flat().some(e=>e?.name===t.CAKE)},g={id:"pizzeria_1",worldId:2,nextLevelId:"pizzeria_2",starThresholds:{1:100,2:75,3:50},name:"4. Margherita",description:"Bake First! Avoid Soggy Dough.",theme:"pizzeria",reactions:[{inputA:t.WATER,inputB:t.FLOUR,output:t.DOUGH,outputState:a.RAW},{inputA:t.FLOUR,inputB:t.WATER,output:t.DOUGH,outputState:a.RAW},{inputA:t.DOUGH,inputB:t.TOMATO,output:t.SAUCED_CRUST,outputState:a.RAW},{inputA:t.TOMATO,inputB:t.DOUGH,output:t.SAUCED_CRUST,outputState:a.RAW},{inputA:t.SAUCED_CRUST,inputB:t.CHEESE,output:t.RAW_PIZZA,outputState:a.RAW},{inputA:t.CHEESE,inputB:t.SAUCED_CRUST,output:t.RAW_PIZZA,outputState:a.RAW},{inputA:t.FIRE,inputB:t.RAW_PIZZA,output:t.PIZZA,outputState:a.COOKED},{inputA:t.RAW_PIZZA,inputB:t.FIRE,output:t.PIZZA,outputState:a.COOKED},{inputA:t.DOUGH,inputB:t.FIRE,output:t.BURNT_GOOP,outputState:a.BURNT},{inputA:t.FIRE,inputB:t.DOUGH,output:t.BURNT_GOOP,outputState:a.BURNT},{inputA:t.SAUCED_CRUST,inputB:t.FIRE,output:t.BURNT_GOOP,outputState:a.BURNT},{inputA:t.FIRE,inputB:t.SAUCED_CRUST,output:t.BURNT_GOOP,outputState:a.BURNT},{inputA:t.DOUGH,inputB:t.CHEESE,output:t.SOGGY_DOUGH,outputState:a.SOGGY},{inputA:t.CHEESE,inputB:t.DOUGH,output:t.SOGGY_DOUGH,outputState:a.SOGGY},{inputA:t.WATER,inputB:t.SOGGY_DOUGH,output:null,outputState:a.RAW},{inputA:t.SOGGY_DOUGH,inputB:t.WATER,output:null,outputState:a.RAW},{inputA:t.WATER,inputB:t.BURNT_GOOP,output:null,outputState:a.RAW},{inputA:t.BURNT_GOOP,inputB:t.WATER,output:null,outputState:a.RAW},{inputA:t.TOMATO,inputB:t.FIRE,output:t.BURNT_GOOP,outputState:a.BURNT},{inputA:t.FIRE,inputB:t.TOMATO,output:t.BURNT_GOOP,outputState:a.BURNT},{inputA:t.CHEESE,inputB:t.FIRE,output:t.BURNT_GOOP,outputState:a.BURNT},{inputA:t.FIRE,inputB:t.CHEESE,output:t.BURNT_GOOP,outputState:a.BURNT}],tileProps:{[t.FLOUR]:{type:"ingredient"},[t.WATER]:{type:"element"},[t.FIRE]:{type:"element",isStatic:!0},[t.DOUGH]:{type:"ingredient"},[t.CRUST]:{type:"ingredient"},[t.SAUCED_CRUST]:{type:"ingredient"},[t.TOMATO]:{type:"ingredient"},[t.CHEESE]:{type:"ingredient"},[t.RAW_PIZZA]:{type:"ingredient"},[t.PIZZA]:{type:"result"},[t.SOGGY_DOUGH]:{type:"blocker"},[t.BURNT_GOOP]:{type:"blocker"}},layout:[{position:[0,3],item:t.FIRE,isStatic:!0}],spawns:{[t.FLOUR]:.3,[t.WATER]:.3,[t.TOMATO]:.2,[t.CHEESE]:.2},difficultySpawns:{easy:{[t.FLOUR]:.4,[t.WATER]:.3,[t.TOMATO]:.2,[t.CHEESE]:.1},medium:{[t.FLOUR]:.3,[t.WATER]:.3,[t.TOMATO]:.2,[t.CHEESE]:.2},hard:{[t.FLOUR]:.25,[t.WATER]:.25,[t.TOMATO]:.25,[t.CHEESE]:.25}},winCondition:o=>o.grid.flat().some(e=>e?.name===t.PIZZA)},v={...g,id:"pizzeria_2",nextLevelId:"pizzeria_3",name:"5. Delivery Rush",description:"Bake a Pizza before time runs out!",theme:"pizzeria",timeLimit:60,starThresholds:{1:150,2:120,3:90},winCondition:o=>o.grid.flat().some(e=>e?.name===t.PIZZA),difficultySpawns:{easy:{[t.FLOUR]:.35,[t.WATER]:.3,[t.TOMATO]:.2,[t.CHEESE]:.1,[t.FIRE]:.05},medium:{[t.FLOUR]:.3,[t.WATER]:.25,[t.TOMATO]:.2,[t.CHEESE]:.15,[t.FIRE]:.1},hard:{[t.FLOUR]:.2,[t.WATER]:.2,[t.TOMATO]:.25,[t.CHEESE]:.15,[t.FIRE]:.2}}},B={...g,id:"pizzeria_3",nextLevelId:"sushi_1",name:"6. Calzone Fold",description:"Fold a Pizza with extra Dough.",theme:"pizzeria",reactions:[...g.reactions,{inputA:t.PIZZA,inputB:t.DOUGH,output:t.CALZONE,outputState:a.COOKED},{inputA:t.DOUGH,inputB:t.PIZZA,output:t.CALZONE,outputState:a.COOKED}],tileProps:{...g.tileProps,[t.CALZONE]:{type:"result"}},difficultySpawns:{easy:{[t.FLOUR]:.4,[t.WATER]:.3,[t.TOMATO]:.15,[t.CHEESE]:.1,[t.FIRE]:.05},medium:{[t.FLOUR]:.3,[t.WATER]:.25,[t.TOMATO]:.2,[t.CHEESE]:.15,[t.FIRE]:.1},hard:{[t.FLOUR]:.25,[t.WATER]:.2,[t.TOMATO]:.2,[t.CHEESE]:.15,[t.FIRE]:.2}},winCondition:o=>o.grid.flat().some(e=>e?.name===t.CALZONE)},D=[{inputA:t.RICE,inputB:t.WATER,output:"Cooked_Rice",outputState:a.COOKED},{inputA:t.WATER,inputB:t.RICE,output:"Cooked_Rice",outputState:a.COOKED},{inputA:t.NORI,inputB:"Cooked_Rice",output:"Sushi_Base",outputState:a.RAW},{inputA:"Cooked_Rice",inputB:t.NORI,output:"Sushi_Base",outputState:a.RAW},{inputA:"Sushi_Base",inputB:t.SASHIMI,output:t.SUSHI,outputState:a.RAW},{inputA:t.SASHIMI,inputB:"Sushi_Base",output:t.SUSHI,outputState:a.RAW},{inputA:t.FISH,inputB:t.KNIFE,output:t.SASHIMI,outputState:a.RAW},{inputA:t.KNIFE,inputB:t.FISH,output:t.SASHIMI,outputState:a.RAW}],H={[t.RICE]:{type:"ingredient"},[t.WATER]:{type:"element"},[t.NORI]:{type:"ingredient"},[t.FISH]:{type:"ingredient"},Cooked_Rice:{type:"ingredient"},Sushi_Base:{type:"ingredient"},[t.SASHIMI]:{type:"ingredient"},[t.SUSHI]:{type:"result"},[t.KNIFE]:{type:"tool",isStatic:!0}},_={id:"sushi_1",worldId:3,nextLevelId:"sushi_2",starThresholds:{1:100,2:70,3:40},name:"7. Rice Fields",description:"Harvest Rice. Lots of it.",theme:"sushi",reactions:D,tileProps:H,spawns:{[t.RICE]:.7,[t.WATER]:.3},winCondition:o=>o.grid.flat().filter(e=>e?.name==="Cooked_Rice").length>=3},U={id:"sushi_2",worldId:3,nextLevelId:"sushi_3",starThresholds:{1:120,2:90,3:60},name:"8. The Knife",description:"Use the Knife to cut Fish into Sashimi.",theme:"sushi",reactions:D,tileProps:H,spawns:{[t.RICE]:.3,[t.WATER]:.2,[t.NORI]:.2,[t.FISH]:.3},layout:[{position:[1,1],item:t.KNIFE,isStatic:!0},{position:[2,2],item:t.KNIFE,isStatic:!0}],winCondition:o=>o.grid.flat().some(e=>e?.name===t.SASHIMI)},L={id:"sushi_3",worldId:3,nextLevelId:"indian_1",starThresholds:{1:200,2:150,3:100},name:"9. Sushi Master",description:"Combine everything!",theme:"sushi",reactions:D,tileProps:H,spawns:{[t.RICE]:.3,[t.WATER]:.2,[t.NORI]:.3,[t.FISH]:.2},layout:[{position:[1,2],item:t.KNIFE,isStatic:!0}],winCondition:o=>o.grid.flat().some(e=>e?.name===t.SUSHI)},k=[{inputA:t.CHILI,inputB:t.GRINDER,output:t.CHILI_POWDER,outputState:a.RAW},{inputA:t.TURMERIC,inputB:t.GRINDER,output:t.TURMERIC_POWDER,outputState:a.RAW},{inputA:t.TOMATO,inputB:t.CHILI_POWDER,output:t.CURRY_BASE,outputState:a.RAW},{inputA:t.CHILI_POWDER,inputB:t.TOMATO,output:t.CURRY_BASE,outputState:a.RAW},{inputA:t.CURRY_BASE,inputB:t.CHICKEN,output:"Raw_Butter_Chicken",outputState:a.RAW},{inputA:t.CHICKEN,inputB:t.CURRY_BASE,output:"Raw_Butter_Chicken",outputState:a.RAW},{inputA:"Raw_Butter_Chicken",inputB:t.FIRE,output:t.BUTTER_CHICKEN,outputState:a.COOKED},{inputA:t.FIRE,inputB:"Raw_Butter_Chicken",output:t.BUTTER_CHICKEN,outputState:a.COOKED},{inputA:t.PANEER,inputB:t.FIRE,output:t.BURNT_GOOP,outputState:a.BURNT},{inputA:t.FIRE,inputB:t.PANEER,output:t.BURNT_GOOP,outputState:a.BURNT},{inputA:t.CHICKEN,inputB:t.FIRE,output:t.BURNT_GOOP,outputState:a.BURNT},{inputA:t.FIRE,inputB:t.CHICKEN,output:t.BURNT_GOOP,outputState:a.BURNT}],G={[t.CHILI]:{type:"ingredient"},[t.TURMERIC]:{type:"ingredient"},[t.PANEER]:{type:"ingredient"},[t.CHICKEN]:{type:"ingredient"},[t.GRINDER]:{type:"tool",isStatic:!0},[t.CHILI_POWDER]:{type:"ingredient"},[t.TURMERIC_POWDER]:{type:"ingredient"},[t.CURRY_BASE]:{type:"ingredient"},[t.BUTTER_CHICKEN]:{type:"result"},[t.TOMATO]:{type:"ingredient"},[t.FIRE]:{type:"element"},Raw_Butter_Chicken:{type:"ingredient"},[t.BURNT_GOOP]:{type:"blocker"}},w={id:"indian_1",worldId:4,nextLevelId:"indian_2",starThresholds:{1:80,2:50,3:30},name:"10. Spice Market",description:"Get familiar with the spices.",theme:"indian",reactions:k,tileProps:G,spawns:{[t.CHILI]:.4,[t.TURMERIC]:.4,[t.TOMATO]:.2},layout:[{position:[1,1],item:t.GRINDER,isStatic:!0}],winCondition:o=>o.grid.flat().filter(e=>e?.name===t.CHILI_POWDER).length>=2},N={id:"indian_2",worldId:4,nextLevelId:"indian_3",starThresholds:{1:100,2:80,3:60},name:"11. The Daily Grind",description:"Process multiple spices.",theme:"indian",reactions:k,tileProps:G,spawns:{[t.CHILI]:.3,[t.TURMERIC]:.3,[t.TOMATO]:.2,[t.FIRE]:.1},layout:[{position:[0,1],item:t.GRINDER,isStatic:!0},{position:[2,2],item:t.GRINDER,isStatic:!0}],winCondition:o=>o.grid.flat().some(e=>e?.name===t.CURRY_BASE)},b={id:"indian_3",worldId:4,nextLevelId:null,starThresholds:{1:150,2:120,3:90},name:"12. Butter Chicken",description:"The Ultimate Dish!",theme:"indian",reactions:k,tileProps:G,spawns:{[t.CHILI]:.2,[t.CHICKEN]:.2,[t.TOMATO]:.3,[t.FIRE]:.2,[t.TURMERIC]:.1},layout:[{position:[1,2],item:t.GRINDER,isStatic:!0}],winCondition:o=>o.grid.flat().some(e=>e?.name===t.BUTTER_CHICKEN)},St=[C,O,y,g,v,B,_,U,L,w,N,b];function It(o){const e={1:[],2:[],3:[],4:[]};St.forEach(n=>{e[n.worldId]&&e[n.worldId].push(n)});const i={1:"The Bakery",2:"The Pizzeria",3:"Sushi Master",4:"Indian Cuisine"},s={1:"bakery",2:"pizzeria",3:"sushi",4:"indian"};return`
    <div id="world-map" class="open-world-layout">
        <h1 class="main-title">The Culinary Journey</h1>
        
        ${[1,2,3,4].map(n=>{const r=e[n];return`
            <div class="world-section theme-${s[n]}">
                <h2 class="world-title">${i[n]}</h2>
                <div class="level-grid">
                    ${r.map(l=>{const R=o.levels[l.id]?.stars||0,c=R>0;return`
                        <div class="level-card ${c?"completed":""}" data-id="${l.id}">
                            <div class="level-card-header">
                                <span class="level-number">${l.name.split(".")[0]}</span>
                                ${c?'<span class="check-icon">✓</span>':""}
                            </div>
                            <div class="level-card-name">${l.name.split(". ")[1]}</div>
                            <div class="stars small">
                                ${Array(3).fill(0).map((E,p)=>`<span class="star ${p<R?"filled":""}">★</span>`).join("")}
                            </div>
                        </div>
                    `}).join("")}
                </div>
            </div>
        `}).join("")}
    </div>
    `}const J={[C.id]:C,[O.id]:O,[y.id]:y,[g.id]:g,[v.id]:v,[B.id]:B,[_.id]:_,[U.id]:U,[L.id]:L,[w.id]:w,[N.id]:N,[b.id]:b},M=document.querySelector("#app");let h=null;const m=new At;function S(){const o=f.load(J);m.clearTimer(),M.innerHTML=It(o),document.querySelectorAll(".level-card").forEach(e=>{e.addEventListener("click",()=>{const i=e.dataset.id;Tt(J[i])})})}function Tt(o){o&&(M.innerHTML=`
      <div class="header-bar">
          <button id="back-btn">← Map</button>
          <div class="level-title">${o.name}</div>
      </div>
      <div class="menu-container">
          <h2>Select Difficulty</h2>
          <p class="level-desc">${o.description}</p>
          
          <div class="difficulty-options">
              <button class="diff-btn" data-diff="easy">
                  <span class="diff-name">Easy</span>
                  <span class="diff-desc">Relaxed Spawns</span>
              </button>
              <button class="diff-btn" data-diff="medium">
                  <span class="diff-name">Medium</span>
                  <span class="diff-desc">Standard Challenge</span>
              </button>
              <button class="diff-btn" data-diff="hard">
                  <span class="diff-name">Hard</span>
                  <span class="diff-desc">Chaos Mode</span>
              </button>
          </div>
      </div>
  `,document.getElementById("back-btn").addEventListener("click",S),document.querySelectorAll(".diff-btn").forEach(e=>{e.addEventListener("click",()=>{const i=e.dataset.diff;X(o,i)})}))}function X(o,e){h=new Q(o,e),h.initialize(),m.setEngine(h),M.innerHTML=`
      <div class="header-bar">
          <button id="back-btn">← Map</button>
          <div class="level-info">
             <div class="level-title">${o.name} <span class="diff-badge">${e.toUpperCase()}</span></div>
             <div class="next-preview">
                <span>Next:</span>
                <img id="next-tile-icon" src="" class="icon-small" />
             </div>
             ${o.timeLimit?'<div id="timer" class="timer-display"></div>':""}
          </div>
      </div>
      <div class="game-container theme-${o.theme||"default"}">
        <div class="grid-bg">
          ${Array(16).fill('<div class="grid-cell"></div>').join("")}
        </div>
        <div id="tile-container"></div>
        <div id="overlay" class="hidden">
            <h2 id="overlay-msg">Game Over</h2>
            <button id="restart-btn">Try Again</button>
            <button id="next-level-btn" class="hidden">Next Level</button>
        </div>
      </div>
      <div class="controls-area">
          <button id="undo-btn" class="control-btn" disabled>↺ Undo</button>
          <div class="arrow-keys-hint">Use Arrow Keys</div>
          <button id="help-btn" class="icon-btn" aria-label="Recipes">?</button>
      </div>
      <div id="score">Score: 0 | Moves: 0</div>
      
      <div id="recipe-slider" class="slider hidden-right">
          <button id="close-help-btn" class="close-btn">×</button>
          <h2>Recipes & Tips</h2>
          <div id="recipe-list"></div>
      </div>
    `,h.on("reaction",r=>{let u="cooked";(r.type==="burnt"||r.type==="soggy")&&(u=r.type),m.showFloatingText(r.text,u)}),m.render(h.getState(),h),o.timeLimit&&m.startTimer(o.timeLimit,()=>{const r=h.getState();r.status==="playing"&&(r.status="lost",m.render(r,h))}),document.getElementById("back-btn").addEventListener("click",()=>{m.clearTimer(),S()}),document.getElementById("restart-btn").addEventListener("click",()=>{X(o,e)}),document.getElementById("undo-btn").addEventListener("click",()=>{h&&h.canUndo()&&(h.undo(),m.render(h.getState(),h))});const i=document.getElementById("help-btn"),s=document.getElementById("close-help-btn"),n=document.getElementById("recipe-slider");i.addEventListener("click",()=>{n.classList.remove("hidden-right"),m.renderRecipes(o)}),s.addEventListener("click",()=>{n.classList.add("hidden-right")}),document.getElementById("next-level-btn").addEventListener("click",()=>{m.clearTimer(),S()})}window.addEventListener("keydown",o=>{if(!h)return;let e=null;switch(o.key){case"ArrowUp":e="up";break;case"ArrowDown":e="down";break;case"ArrowLeft":e="left";break;case"ArrowRight":e="right";break}e&&(o.preventDefault(),h.move(e),m.render(h.getState(),h))});S();
